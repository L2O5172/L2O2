<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>ç¾å‘³å»šæˆ¿åº—å®¶ç®¡ç†ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        @media print {
            body * {
                visibility: hidden;
            }
            .print-area, .print-area * {
                visibility: visible;
            }
            .print-area {
                position: absolute !important;
                left: 0 !important;
                top: 0 !important;
                width: 100% !important;
            }
            .print-area * {
                color: #000 !important;
                background-color: transparent !important;
                box-shadow: none !important;
                border-color: #ddd !important;
            }
            .no-print {
                display: none !important;
            }
        }
        .status-pending { background-color: #fef3c7; color: #92400e; }
        .status-confirmed { background-color: #dbeafe; color: #1e40af; }
        .status-preparing { background-color: #f3e8ff; color: #6b21a8; }
        .status-ready { background-color: #dcfce7; color: #166534; }
        .status-completed { background-color: #e5e7eb; color: #374151; }
        .status-cancelled { background-color: #fecaca; color: #991b1b; }
        
        .stat-card {
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fade-in 0.5s ease-out; }
        
        .loading-spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-slate-100">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        
        // åœ–æ¨™çµ„ä»¶
        const PlusIcon = ({ className = "h-5 w-5" }) => (
          <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
          </svg>
        );

        const MinusIcon = ({ className = "h-5 w-5" }) => (
          <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M18 12H6" />
          </svg>
        );

        const TrashIcon = ({ className = "h-5 w-5" }) => (
          <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
          </svg>
        );

        const CloseIcon = ({ className = "h-6 w-6" }) => (
          <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
          </svg>
        );

        const CartIcon = ({ className = "h-6 w-6" }) => (
          <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m-6 4a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z" />
          </svg>
        );

        const CheckIcon = ({ className = "h-6 w-6" }) => (
          <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
          </svg>
        );
        
        const SearchIcon = ({ className = "h-5 w-5" }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
        );

        const RefreshIcon = ({ className = "h-5 w-5" }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
        );
        
        const PencilIcon = ({ className = "h-5 w-5" }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z" />
            </svg>
        );

        const ChartIcon = ({ className = "h-5 w-5" }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
            </svg>
        );

        const PrinterIcon = ({ className = "h-5 w-5" }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
            </svg>
        );

        // API æœå‹™ - ä½¿ç”¨æ‚¨æä¾›çš„éƒ¨ç½² URL
        const API_URL = 'https://script.google.com/macros/s/AKfycbzjaQetvgEgkXfcahjL4iqnaWvUuHAJ1NJZRKlsLOA-QjTOq9GGJlK2tf-QJKuSjvtVsQ/exec';

        const apiService = {
          async getOrders() {
            try {
              const response = await fetch(`${API_URL}?action=getOrders`);
              if (!response.ok) {
                throw new Error('Network response was not ok');
              }
              const data = await response.json();
              console.log('API Response:', data);
              
              if (data.success && data.orders) {
                return { success: true, orders: data.orders };
              } else {
                throw new Error(data.message || 'ç²å–è¨‚å–®æ•¸æ“šå¤±æ•—');
              }
              
            } catch (error) {
              console.warn("API fetch failed:", error);
              return { success: false, message: error.message, orders: [] };
            }
          },

          async updateOrderStatus(orderId, status) {
            try {
                const payload = {
                    action: 'updateOrderStatus',
                    orderId: orderId,
                    status: status
                };
                
                console.log('Sending update request:', payload);
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8',
                    },
                    body: JSON.stringify(payload),
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Server error: ${response.status} ${response.statusText}. Response: ${errorText}`);
                }
                
                const responseText = await response.text();
                console.log('Update response:', responseText);
                
                try {
                    const result = JSON.parse(responseText);
                    return result;
                } catch (e) {
                    throw new Error(`Received an invalid response from the server: ${responseText}`);
                }

            } catch (error) {
                console.error("Failed to update order status:", error);
                throw error;
            }
          }
        };

        // åŠ è¼‰å‹•ç•«çµ„ä»¶
        const LoadingSpinner = () => (
            <div className="flex items-center justify-center">
                <div className="loading-spinner"></div>
            </div>
        );

        // é€šçŸ¥çµ„ä»¶
        const Notification = ({ message, type, visible, onClose }) => {
            if (!visible) return null;
            
            const typeClasses = {
                success: "bg-green-500 text-white",
                error: "bg-red-500 text-white",
                warning: "bg-yellow-500 text-white",
                info: "bg-blue-500 text-white"
            };
            
            return (
                <div className={`fixed top-5 right-5 max-w-sm p-4 rounded-lg shadow-lg z-50 animate-fade-in ${typeClasses[type]}`}>
                    <div className="flex justify-between items-center">
                        <p className="text-sm font-medium whitespace-pre-wrap">{message}</p>
                        <button onClick={onClose} className="ml-4 text-xl font-bold leading-none hover:opacity-70">
                            &times;
                        </button>
                    </div>
                </div>
            );
        };

        // çµ±è¨ˆå¡ç‰‡çµ„ä»¶
        const StatCard = ({ title, value, subtitle, icon, color, trend }) => (
            <div className={`stat-card bg-white rounded-lg p-6 border-l-4 ${color} shadow-sm`}>
                <div className="flex justify-between items-start">
                    <div>
                        <p className="text-sm font-medium text-gray-600">{title}</p>
                        <p className="text-2xl font-bold text-gray-900 mt-1">{value}</p>
                        {subtitle && <p className="text-sm text-gray-500 mt-1">{subtitle}</p>}
                        {trend && (
                            <p className={`text-xs font-medium mt-2 ${trend.value > 0 ? 'text-green-600' : 'text-red-600'}`}>
                                {trend.value > 0 ? 'â†—' : 'â†˜'} {Math.abs(trend.value)}% {trend.label}
                            </p>
                        )}
                    </div>
                    <div className="text-3xl opacity-80">
                        {icon}
                    </div>
                </div>
            </div>
        );

        // è¨‚å–®å¡ç‰‡çµ„ä»¶
        const OrderCard = ({ order, onStatusUpdate, onPrint }) => {
            const [isProcessing, setIsProcessing] = useState(false);

            const formatDate = (dateString) => {
                try {
                    if (!dateString) return 'æœªè¨­å®š';
                    const date = new Date(dateString);
                    return isNaN(date.getTime()) ? dateString : date.toLocaleString('zh-TW');
                } catch {
                    return dateString || 'æœªè¨­å®š';
                }
            };

            const getStatusText = (status) => {
                switch (status) {
                    case 'confirmed': return 'å·²ç¢ºèª';
                    case 'preparing': return 'è£½ä½œä¸­';
                    case 'ready': return 'å¯å–é¤';
                    case 'completed': return 'å·²å®Œæˆ';
                    case 'cancelled': return 'å·²å–æ¶ˆ';
                    case 'pending': return 'å¾…ç¢ºèª';
                    default: return status || 'æœªçŸ¥';
                }
            };

            const handleStatusUpdate = async (newStatus) => {
                if (isProcessing) return;
                setIsProcessing(true);
                try {
                    await onStatusUpdate(order.id, newStatus);
                } catch (error) {
                    console.error('æ›´æ–°ç‹€æ…‹å¤±æ•—:', error);
                    throw error;
                } finally {
                    setIsProcessing(false);
                }
            };

            const statusOptions = [
                { value: 'pending', label: 'å¾…ç¢ºèª', color: 'status-pending' },
                { value: 'confirmed', label: 'å·²ç¢ºèª', color: 'status-confirmed' },
                { value: 'preparing', label: 'è£½ä½œä¸­', color: 'status-preparing' },
                { value: 'ready', label: 'å¯å–é¤', color: 'status-ready' },
                { value: 'completed', label: 'å·²å®Œæˆ', color: 'status-completed' },
                { value: 'cancelled', label: 'å·²å–æ¶ˆ', color: 'status-cancelled' }
            ];

            return (
                <div className="bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden animate-fade-in">
                    {/* è¨‚å–®æ¨™é ­ */}
                    <div className="bg-gray-50 px-4 py-3 border-b border-gray-200">
                        <div className="flex justify-between items-start">
                            <div className="flex-1">
                                <h3 className="font-bold text-lg break-words">{order.id || 'æœªæŒ‡å®šè¨‚å–®ç·¨è™Ÿ'}</h3>
                                <p className="text-sm text-gray-600 mt-1">
                                    {order.customerName || 'æœªæä¾›å§“å'} â€¢ {order.customerPhone || 'æœªæä¾›é›»è©±'}
                                </p>
                            </div>
                            <div className="text-right ml-4">
                                <span className={`px-3 py-1 rounded-full text-sm font-medium ${statusOptions.find(s => s.value === order.status)?.color || 'status-pending'}`}>
                                    {getStatusText(order.status)}
                                </span>
                                <p className="text-sm text-gray-500 mt-1">
                                    {formatDate(order.createdAt)}
                                </p>
                            </div>
                        </div>
                    </div>

                    {/* è¨‚å–®å…§å®¹ */}
                    <div className="p-4">
                        <div className="mb-4">
                            <h4 className="font-semibold mb-2">è¨‚å–®å…§å®¹:</h4>
                            <div className="bg-gray-50 rounded-lg p-3">
                                <div className="space-y-2">
                                    {order.items && order.items.map((item, index) => (
                                        <div key={index} className="flex justify-between text-sm">
                                            <span className="flex-1">
                                                {item.name} 
                                                <span className="text-gray-500 ml-2">x{item.quantity}</span>
                                            </span>
                                            <span className="ml-4">
                                                ${(item.price * item.quantity).toLocaleString()}
                                            </span>
                                        </div>
                                    ))}
                                </div>
                                <div className="border-t mt-2 pt-2 font-bold">
                                    <div className="flex justify-between">
                                        <span>ç¸½é‡‘é¡:</span>
                                        <span>${order.totalAmount ? order.totalAmount.toLocaleString() : '0'}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-4">
                            <div>
                                <p><strong>è¨‚å–®é¡å‹:</strong> {order.orderType || 'æœªæŒ‡å®š'}</p>
                                {order.tableNumber && (
                                    <p><strong>æ¡Œè™Ÿ:</strong> {order.tableNumber}</p>
                                )}
                            </div>
                            <div>
                                <p><strong>ç¸½é‡‘é¡:</strong> <span className="text-green-600 font-bold">${order.totalAmount ? order.totalAmount.toLocaleString() : '0'}</span></p>
                                {order.notes && (
                                    <p className="break-words"><strong>é¡§å®¢å‚™è¨»:</strong> {order.notes}</p>
                                )}
                            </div>
                        </div>

                        {/* æ“ä½œæŒ‰éˆ• */}
                        <div className="flex flex-wrap gap-2">
                            <select
                                value={order.status || 'pending'}
                                onChange={(e) => handleStatusUpdate(e.target.value)}
                                disabled={isProcessing}
                                className="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white"
                            >
                                {statusOptions.map(option => (
                                    <option key={option.value} value={option.value}>
                                        {option.label}
                                    </option>
                                ))}
                            </select>

                            <button
                                onClick={() => onPrint(order)}
                                className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors"
                            >
                                <PrinterIcon className="h-4 w-4" />
                                åˆ—å°
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // éŠ·å”®çµ±è¨ˆçµ„ä»¶
        const SalesStatistics = ({ orders, currentView, onViewChange }) => {
            const [dateRange, setDateRange] = useState('today');
            const [selectedMonth, setSelectedMonth] = useState(new Date().toISOString().slice(0, 7));

            // ç²å–æ—¥æœŸç¯„åœ
            const getDateRange = useMemo(() => {
                const now = new Date();
                const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
                const startOfYear = new Date(now.getFullYear(), 0, 1);
                
                const [year, month] = selectedMonth.split('-').map(Number);
                const startOfSelectedMonth = new Date(year, month - 1, 1);
                const endOfSelectedMonth = new Date(year, month, 0, 23, 59, 59);

                return {
                    today: { start: startOfDay, end: now },
                    month: { start: startOfMonth, end: now },
                    year: { start: startOfYear, end: now },
                    custom: { start: startOfSelectedMonth, end: endOfSelectedMonth }
                }[dateRange];
            }, [dateRange, selectedMonth]);

            // ç¯©é¸è¨‚å–®
            const filteredOrders = useMemo(() => {
                const { start, end } = getDateRange;
                return orders.filter(order => {
                    if (!order.createdAt) return false;
                    const orderDate = new Date(order.createdAt);
                    return orderDate >= start && orderDate <= end && order.status !== 'cancelled';
                });
            }, [orders, getDateRange]);

            // è¨ˆç®—çµ±è¨ˆæ•¸æ“š
            const statistics = useMemo(() => {
                // ç‡Ÿæ¥­é¡çµ±è¨ˆ
                const totalRevenue = filteredOrders.reduce((sum, order) => sum + (order.totalAmount || 0), 0);

                // å®¢æ•¸çµ±è¨ˆ
                const customerCount = filteredOrders.length;

                // ç†±é–€å•†å“çµ±è¨ˆ
                const itemSales = {};
                filteredOrders.forEach(order => {
                    if (order.items) {
                        order.items.forEach(item => {
                            const itemName = item.name;
                            if (!itemSales[itemName]) {
                                itemSales[itemName] = { quantity: 0, revenue: 0 };
                            }
                            itemSales[itemName].quantity += item.quantity || 0;
                            itemSales[itemName].revenue += (item.price || 0) * (item.quantity || 0);
                        });
                    }
                });

                // è½‰æ›ç‚ºé™£åˆ—ä¸¦æ’åº
                const popularItems = Object.entries(itemSales)
                    .map(([name, data]) => ({ name, ...data }))
                    .sort((a, b) => b.quantity - a.quantity);

                // æ¯æ—¥æ•¸æ“š
                const dailyData = {};
                filteredOrders.forEach(order => {
                    if (order.createdAt) {
                        const date = new Date(order.createdAt).toLocaleDateString('zh-TW');
                        if (!dailyData[date]) {
                            dailyData[date] = { revenue: 0, customers: 0, orders: 0 };
                        }
                        dailyData[date].revenue += order.totalAmount || 0;
                        dailyData[date].customers += 1;
                        dailyData[date].orders += 1;
                    }
                });

                return {
                    totalRevenue,
                    customerCount,
                    popularItems,
                    dailyData,
                    averageOrderValue: customerCount > 0 ? totalRevenue / customerCount : 0,
                    totalOrders: filteredOrders.length
                };
            }, [filteredOrders]);

            // åœ–è¡¨å¼•ç”¨
            const revenueChartRef = React.useRef(null);
            const customerChartRef = React.useRef(null);
            const popularItemsChartRef = React.useRef(null);

            // åˆå§‹åŒ–åœ–è¡¨
            useEffect(() => {
                // æ¸…ç†èˆŠåœ–è¡¨
                if (revenueChartRef.current) {
                    const chartInstance = Chart.getChart(revenueChartRef.current);
                    if (chartInstance) {
                        chartInstance.destroy();
                    }
                }
                if (customerChartRef.current) {
                    const chartInstance = Chart.getChart(customerChartRef.current);
                    if (chartInstance) {
                        chartInstance.destroy();
                    }
                }
                if (popularItemsChartRef.current) {
                    const chartInstance = Chart.getChart(popularItemsChartRef.current);
                    if (chartInstance) {
                        chartInstance.destroy();
                    }
                }

                // å‰µå»ºæ–°åœ–è¡¨
                if (revenueChartRef.current && Object.keys(statistics.dailyData).length > 0) {
                    const ctx = revenueChartRef.current.getContext('2d');
                    const dates = Object.keys(statistics.dailyData).sort();
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: dates,
                            datasets: [{
                                label: 'æ¯æ—¥ç‡Ÿæ¥­é¡',
                                data: dates.map(date => statistics.dailyData[date].revenue),
                                borderColor: 'rgb(34, 197, 94)',
                                backgroundColor: 'rgba(34, 197, 94, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                },
                                title: {
                                    display: true,
                                    text: 'æ¯æ—¥ç‡Ÿæ¥­é¡è¶¨å‹¢'
                                }
                            }
                        }
                    });
                }

                if (customerChartRef.current && Object.keys(statistics.dailyData).length > 0) {
                    const ctx = customerChartRef.current.getContext('2d');
                    const dates = Object.keys(statistics.dailyData).sort();
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: dates,
                            datasets: [{
                                label: 'æ¯æ—¥å®¢æ•¸',
                                data: dates.map(date => statistics.dailyData[date].customers),
                                borderColor: 'rgb(59, 130, 246)',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                },
                                title: {
                                    display: true,
                                    text: 'æ¯æ—¥å®¢æ•¸è¶¨å‹¢'
                                }
                            }
                        }
                    });
                }

                if (popularItemsChartRef.current && statistics.popularItems.length > 0) {
                    const ctx = popularItemsChartRef.current.getContext('2d');
                    const topItems = statistics.popularItems.slice(0, 8);
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: topItems.map(item => item.name),
                            datasets: [{
                                label: 'éŠ·å”®æ•¸é‡',
                                data: topItems.map(item => item.quantity),
                                backgroundColor: [
                                    'rgba(255, 99, 132, 0.8)',
                                    'rgba(54, 162, 235, 0.8)',
                                    'rgba(255, 206, 86, 0.8)',
                                    'rgba(75, 192, 192, 0.8)',
                                    'rgba(153, 102, 255, 0.8)',
                                    'rgba(255, 159, 64, 0.8)',
                                    'rgba(199, 199, 199, 0.8)',
                                    'rgba(83, 102, 255, 0.8)'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                },
                                title: {
                                    display: true,
                                    text: 'ç†±é–€å•†å“éŠ·å”®æ’è¡Œ'
                                }
                            }
                        }
                    });
                }
            }, [statistics]);

            return (
                <div className="animate-fade-in">
                    <div className="flex items-center mb-6">
                        <button onClick={() => onViewChange('orders')} className="text-gray-600 hover:text-gray-800 mr-3">
                            â† è¿”å›è¨‚å–®ç®¡ç†
                        </button>
                        <h2 className="text-2xl font-bold">éŠ·å”®çµ±è¨ˆå ±è¡¨</h2>
                    </div>

                    {/* æ™‚é–“ç¯„åœé¸æ“‡ */}
                    <div className="bg-white rounded-lg p-4 border border-gray-200 shadow-sm mb-6">
                        <div className="flex flex-wrap gap-4 items-center">
                            <label className="font-medium">çµ±è¨ˆæœŸé–“:</label>
                            <select 
                                value={dateRange} 
                                onChange={(e) => setDateRange(e.target.value)}
                                className="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500"
                            >
                                <option value="today">ä»Šæ—¥</option>
                                <option value="month">æœ¬æœˆ</option>
                                <option value="year">ä»Šå¹´</option>
                                <option value="custom">é¸æ“‡æœˆä»½</option>
                            </select>
                            
                            {dateRange === 'custom' && (
                                <input
                                    type="month"
                                    value={selectedMonth}
                                    onChange={(e) => setSelectedMonth(e.target.value)}
                                    className="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500"
                                />
                            )}
                            
                            <div className="text-sm text-gray-600">
                                å…± {statistics.totalOrders} ç­†è¨‚å–®ï¼Œ{statistics.customerCount} ä½é¡§å®¢
                            </div>
                        </div>
                    </div>

                    {/* çµ±è¨ˆå¡ç‰‡ */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <StatCard
                            title="ç¸½ç‡Ÿæ¥­é¡"
                            value={`$${statistics.totalRevenue.toLocaleString()}`}
                            subtitle={`${dateRange === 'today' ? 'ä»Šæ—¥' : dateRange === 'month' ? 'æœ¬æœˆ' : 'ä»Šå¹´'}ç‡Ÿæ¥­é¡`}
                            icon="ğŸ’°"
                            color="border-l-blue-500"
                        />
                        <StatCard
                            title="ç¸½å®¢æ•¸"
                            value={statistics.customerCount.toLocaleString()}
                            subtitle={`${dateRange === 'today' ? 'ä»Šæ—¥' : dateRange === 'month' ? 'æœ¬æœˆ' : 'ä»Šå¹´'}å®¢æ•¸`}
                            icon="ğŸ‘¥"
                            color="border-l-green-500"
                        />
                        <StatCard
                            title="å¹³å‡å®¢å–®åƒ¹"
                            value={`$${Math.round(statistics.averageOrderValue)}`}
                            subtitle="æ¯ç­†è¨‚å–®å¹³å‡é‡‘é¡"
                            icon="ğŸ“Š"
                            color="border-l-purple-500"
                        />
                        <StatCard
                            title="è¨‚å–®æ•¸é‡"
                            value={statistics.totalOrders}
                            subtitle="æˆåŠŸäº¤æ˜“è¨‚å–®æ•¸"
                            icon="ğŸ“¦"
                            color="border-l-orange-500"
                        />
                    </div>

                    {/* åœ–è¡¨å€åŸŸ */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        {/* ç‡Ÿæ¥­é¡è¶¨å‹¢åœ– */}
                        <div className="bg-white rounded-lg p-6 border border-gray-200 shadow-sm">
                            <h3 className="text-lg font-bold mb-4">æ¯æ—¥ç‡Ÿæ¥­é¡è¶¨å‹¢</h3>
                            <div className="h-80">
                                <canvas ref={revenueChartRef}></canvas>
                            </div>
                        </div>

                        {/* å®¢æ•¸è¶¨å‹¢åœ– */}
                        <div className="bg-white rounded-lg p-6 border border-gray-200 shadow-sm">
                            <h3 className="text-lg font-bold mb-4">æ¯æ—¥å®¢æ•¸è¶¨å‹¢</h3>
                            <div className="h-80">
                                <canvas ref={customerChartRef}></canvas>
                            </div>
                        </div>
                    </div>

                    {/* ç†±é–€å•†å“éŠ·å”® */}
                    <div className="bg-white rounded-lg p-6 border border-gray-200 shadow-sm mb-8">
                        <h3 className="text-lg font-bold mb-4">ç†±é–€å•†å“éŠ·å”®æ’è¡Œ</h3>
                        <div className="h-80">
                            <canvas ref={popularItemsChartRef}></canvas>
                        </div>
                    </div>

                    {/* è©³ç´°éŠ·å”®è¡¨æ ¼ */}
                    <div className="bg-white rounded-lg p-6 border border-gray-200 shadow-sm">
                        <h3 className="text-lg font-bold mb-4">å•†å“éŠ·å”®æ˜ç´°</h3>
                        <div className="overflow-x-auto">
                            <table className="w-full border-collapse">
                                <thead>
                                    <tr className="bg-gray-50">
                                        <th className="border border-gray-200 p-3 text-left">æ’å</th>
                                        <th className="border border-gray-200 p-3 text-left">å•†å“åç¨±</th>
                                        <th className="border border-gray-200 p-3 text-center">éŠ·å”®æ•¸é‡</th>
                                        <th className="border border-gray-200 p-3 text-right">éŠ·å”®é‡‘é¡</th>
                                        <th className="border border-gray-200 p-3 text-right">ä½”æ¯”</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {statistics.popularItems.map((item, index) => (
                                        <tr key={index} className="hover:bg-gray-50">
                                            <td className="border border-gray-200 p-3 font-medium">#{index + 1}</td>
                                            <td className="border border-gray-200 p-3">{item.name}</td>
                                            <td className="border border-gray-200 p-3 text-center">{item.quantity}</td>
                                            <td className="border border-gray-200 p-3 text-right">${item.revenue.toLocaleString()}</td>
                                            <td className="border border-gray-200 p-3 text-right">
                                                {statistics.totalRevenue > 0 
                                                    ? `${((item.revenue / statistics.totalRevenue) * 100).toFixed(1)}%`
                                                    : '0%'
                                                }
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                                <tfoot>
                                    <tr className="bg-gray-100 font-bold">
                                        <td className="border border-gray-200 p-3" colSpan="2">ç¸½è¨ˆ</td>
                                        <td className="border border-gray-200 p-3 text-center">
                                            {statistics.popularItems.reduce((sum, item) => sum + item.quantity, 0)}
                                        </td>
                                        <td className="border border-gray-200 p-3 text-right">${statistics.total
